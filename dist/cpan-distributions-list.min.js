/*! CPAN Distributions List - v0.1.0 - 2013-07-08
* https://github.com/guillaumeaubert/jquery-cpan-distributions-list
* Copyright (c) 2013 Guillaume Aubert; Licensed GPLv3 */
!function(a){a.fn.createDistributionsList=function(b){function c(b){a.ajax({type:"GET",async:!0,dataType:"json",url:"https://api.github.com/users/"+g.github_id+"/repos",success:function(c){return 0===c.length?(alert("GitHub returned no repositories for this username!"),void 0):(c.forEach(function(c){var e=c.name,f=d(e);b.find("tr#distribution_"+e+" td.github_open_issues").html(a("<a>").attr("href","https://github.com/"+g.github_id+"/"+f+"/issues").html(c.open_issues_count))}),g.on_success&&g.on_success(c),void 0)},error:function(a){alert("Error: "+a.statusText)}})}function d(a){return g.repositories[a]?g.repositories[a]:g.repository_lowercase?a.toLowerCase():a}function e(b,c,e,h){var i=d(c),j={distribution:c,version:e,date:h,travis_status_badge:g.travis_ci?a("<a>").attr("href","https://travis-ci.org/"+g.github_id+"/"+i).html(a("<img>").attr("src","https://travis-ci.org/"+g.github_id+"/"+i+".png?branch=master").attr("alt","Build Status")):"",coveralls_badge:g.coveralls?a("<a>").attr("href","https://coveralls.io/r/"+g.github_id+"/"+i+"?branch=master").html(a("<img>").attr("src","https://coveralls.io/repos/"+g.github_id+"/"+i+"/badge.png?branch=master").attr("alt","Coverage Status")):"",github:a("<a>").attr("href","https://github.com/"+g.github_id+"/"+i).html("GitHub"),metacpan:a("<a>").attr("href","https://metacpan.org/release/"+c).html("MetaCPAN"),cpants:a("<a>").attr("href","http://cpants.cpanauthors.org/dist/"+c).html("CPANTS")},k=g.template_row.clone();for(var l in j)k.find("."+l).html(j[l]);k.css("display",""),k.attr("id","distribution_"+c),k.addClass("distribution"),k.removeClass("template"),f.find("tbody:last").append(k)}var f=this;f.find("tbody:last tr.distribution").remove();var g=a.extend({pause_id:"AUBERTG",github_id:"guillaumeaubert",coveralls:!0,travis_ci:!0,repositories:{},repository_lowercase:!1,template_row:this.find("tr.template:first")},b);a.ajax({type:"GET",async:!0,dataType:"json",url:"http://api.metacpan.org/v0/release/_search?q=author:"+g.pause_id+"%20AND%20status:latest&fields=version,distribution,date&size=100&sort=distribution",success:function(a){return"false"===a.timed_out?(alert("MetaCPAN timed out ("+a.timed_out+")!"),void 0):0===a.hits.total?(alert("MetaCPAN returned no distributions for this author!"),void 0):(a.hits.hits.forEach(function(a,b){e(b,a.fields.distribution,a.fields.version,a.fields.date)}),c(f),void 0)},error:function(a){alert("Error: "+a.statusText)}})}}(jQuery);